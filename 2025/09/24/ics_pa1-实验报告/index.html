<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DIMS|ICS_PA1 实验报告</title>
  
  
  <meta name="description" content="🐙">
  <meta name="author" content="OCTOPUS">
  
  
  
  <meta property="og:url" content="http://localhost:1313/2025/09/24/ics_pa1-%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/">
  <meta property="og:site_name" content="DIMS">
  <meta property="og:title" content="ICS_PA1 实验报告">
  <meta property="og:description" content="实验进度 我已完成 PA1 的所有内容，并通过了所有的测试样例。
必答题 程序是个状态机 问题： 画出计算 1&#43;2&#43;…&#43;100 的程序的状态机。
Solution:
// PC: instruction | // label: statement 0: mov r1, 0 | pc0: r1 = 0; 1: mov r2, 0 | pc1: r2 = 0; 2: addi r2, r2 , 1 | pc2: r2 = r2 &#43; 1; 3: add r1, r1 , r2 | pc3: r1 = r1 &#43; r2; 4: cmp r2 100 | pc4: compare r2 with 100; 5: jl 2 | pc5: if r2 &lt; 100, jump to pc2 程序的状态机如下：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-09-24T19:04:44+00:00">
    <meta property="article:modified_time" content="2025-09-24T19:04:44+00:00">
    <meta property="article:tag" content="ICS">
    <meta property="article:tag" content="PA">

  
  
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="ICS_PA1 实验报告">
  <meta name="twitter:description" content="实验进度 我已完成 PA1 的所有内容，并通过了所有的测试样例。
必答题 程序是个状态机 问题： 画出计算 1&#43;2&#43;…&#43;100 的程序的状态机。
Solution:
// PC: instruction | // label: statement 0: mov r1, 0 | pc0: r1 = 0; 1: mov r2, 0 | pc1: r2 = 0; 2: addi r2, r2 , 1 | pc2: r2 = r2 &#43; 1; 3: add r1, r1 , r2 | pc3: r1 = r1 &#43; r2; 4: cmp r2 100 | pc4: compare r2 with 100; 5: jl 2 | pc5: if r2 &lt; 100, jump to pc2 程序的状态机如下：">

  
  
  <script>
    (function() {
      
      document.documentElement.classList.add('dark');
      localStorage.theme = 'dark';
    })();
  </script>
  
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Noto+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet">
  
  
  <link rel="icon" type="image/webp" href="/images/favicon.webp">
  
  
  
  <link rel="stylesheet" href="/css/index.min.css">
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  
  
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
  
</head>
<body class=" is-post">
  
<div class="floating-shapes">
  <span class="shape" style="--delay:0s;--x:15%;--y:25%">✦</span>
  <span class="shape" style="--delay:1.2s;--x:85%;--y:15%">○</span>
  <span class="shape" style="--delay:2.5s;--x:75%;--y:65%">✦</span>
  <span class="shape" style="--delay:0.8s;--x:10%;--y:55%">○</span>
  <span class="shape" style="--delay:1.8s;--x:90%;--y:45%">✦</span>
  <span class="shape" style="--delay:3s;--x:25%;--y:80%">○</span>
</div>

  <header class="header" data-glass-nav data-liquid-glass="header">
  <div class="header-inner">
    <a href="/" class="logo">
      <span class="logo-text">DIMS</span>
    </a>
    
    <nav class="nav">
      
        <a href="/" class="nav-link">
          主页
        </a>
      
        <a href="/archives" class="nav-link">
          归档
        </a>
      
        <a href="/gallery" class="nav-link">
          相册
        </a>
      
        <a href="/moments" class="nav-link">
          日志
        </a>
      
        <a href="/about" class="nav-link">
          关于
        </a>
      
    </nav>
    
    <div class="header-actions">
      
      <button class="icon-btn search-toggle" aria-label="Search">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
        </svg>
      </button>
    </div>
  </div>
</header>


<div class="search-modal" id="searchModal">
  <div class="search-container">
    <div class="search-box">
      <input type="text" class="search-input" id="searchInput" placeholder="搜索文章..." autocomplete="off">
      <button class="icon-btn search-close" id="searchClose" aria-label="Close search">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    <div class="search-results" id="searchResults"></div>
    <div class="search-footer">
      <span class="search-hint">按 <kbd>ESC</kbd> 关闭</span>
      <span class="search-hint"><kbd>↑</kbd> <kbd>↓</kbd> 选择</span>
      <span class="search-hint"><kbd>Enter</kbd> 打开</span>
    </div>
  </div>
</div>

  
  <main class="main">
    <div class="layout layout-full">
      <section class="content content-full">
        
<article class="post">
  
  <div class="container">
    <header class="post-header">
      <h1 class="post-title">ICS_PA1 实验报告</h1>
      <div class="post-meta">
        <time class="post-date" datetime="2025-09-24T19:04:44Z">2025年09月24日</time>
        
          <span class="post-categories">
            
              <a href="/categories/%E6%8A%A5%E5%91%8A/" class="category-link">报告</a>
            
          </span>
        
        
          <span class="post-wordcount">767 字</span>
        
      </div>
    </header>
    
    <div class="post-body">
      
        <aside class="post-toc">
          <div class="toc-header">
            <span class="toc-title">目录</span>
          </div>
          <div class="toc-content">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#实验进度">实验进度</a></li>
    <li><a href="#必答题">必答题</a>
      <ul>
        <li><a href="#程序是个状态机">程序是个状态机</a></li>
        <li><a href="#理解基础设施">理解基础设施</a></li>
        <li><a href="#rtfm理解科学查阅手册的方法">RTFM：理解科学查阅手册的方法</a></li>
        <li><a href="#shell-命令统计代码行数">Shell 命令统计代码行数</a></li>
        <li><a href="#编译选项解释">编译选项解释</a></li>
      </ul>
    </li>
    <li><a href="#遇到的问题--看法以及趣事">遇到的问题 &amp; 看法以及趣事😊</a>
      <ul>
        <li><a href="#神秘的0">神秘的➗0:</a></li>
        <li><a href="#运算符的结合性与无符号运算">运算符的结合性与无符号运算：</a></li>
      </ul>
    </li>
    <li><a href="#思考题">思考题</a></li>
    <li><a href="#实验心情">实验心情</a></li>
  </ul>
</nav>
          </div>
        </aside>
      
      
      <div class="post-content">
        <h2 id="实验进度">实验进度</h2>
<p>我已完成 PA1 的<strong>所有内容</strong>，并通过了<strong>所有的测试样例</strong>。</p>
<hr>
<h2 id="必答题">必答题</h2>
<h3 id="程序是个状态机">程序是个状态机</h3>
<p><strong>问题：</strong> 画出计算 1+2+&hellip;+100 的程序的状态机。</p>
<p><strong>Solution:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">// PC: instruction   | // label: statement
</span></span><span class="line"><span class="cl">0: mov r1, 0         | pc0: r1 = 0;
</span></span><span class="line"><span class="cl">1: mov r2, 0         | pc1: r2 = 0;
</span></span><span class="line"><span class="cl">2: addi r2, r2 , 1   | pc2: r2 = r2 + 1;
</span></span><span class="line"><span class="cl">3: add r1, r1 , r2   | pc3: r1 = r1 + r2;
</span></span><span class="line"><span class="cl">4: cmp r2 100        | pc4: compare r2 with 100;
</span></span><span class="line"><span class="cl">5: jl 2              | pc5: if r2 &lt; 100, jump to pc2
</span></span></code></pre></div><p>程序的状态机如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">//(PC,r1,r2)
</span></span><span class="line"><span class="cl">(0,x,x)→(1,0,x)→
</span></span><span class="line"><span class="cl">(2,0,0)→(3,0,1)→(4,1,1)→(5,1,1)→
</span></span><span class="line"><span class="cl">(2,1,1)→(3,1,2)→(4,3,2)→(5,3,2)→
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">(2,4851,98)→(3,4851,99)→(4,4950,99)→(5,4950,99)→
</span></span><span class="line"><span class="cl">(2,4950,99)→(3,4950,100)→(4,5050,100)→end
</span></span></code></pre></div><hr>
<h3 id="理解基础设施">理解基础设施</h3>
<p><strong>问题：</strong> 通过计算来体会简易调试器的作用。</p>
<p><strong>假设条件：</strong></p>
<ul>
<li>需要编译 500 次 NEMU 才能完成 PA。</li>
<li>500 次编译中，有 90% 的次数用于调试。</li>
<li>没有实现简易调试器时，只能通过 GDB 调试，每次获取并分析一个信息需要 30 秒。</li>
<li>需要获取并分析 20 个信息才能排除一个 bug。</li>
<li>通过简易调试器只需要花费 10 秒的时间获取并分析相同的信息。</li>
</ul>
<p><strong>解答：</strong>
<strong>（1）没有简易调试器的情况：</strong></p>
<ul>
<li>用于调试的编译次数：500×90 次</li>
<li>每次调试总时间：20 个信息×30 秒/信息=600 秒</li>
<li>总调试时间：450 次×600 秒/次=270,000 秒</li>
<li>总调试时间（小时）：270,000÷3600=75 小时
如果没有简易调试器，将在调试上花费 <strong>75 小时</strong>。</li>
</ul>
<p><strong>（2）使用简易调试器的情况：</strong></p>
<ul>
<li>每次调试总时间：20 个信息×10 秒/信息=200 秒</li>
<li>总调试时间：450 次×200 秒/次=90,000 秒</li>
<li>总调试时间（小时）：90,000÷3600=25 小时</li>
<li>节省的时间：75−25=50 小时
使用简易调试器可以节省 <strong>50 小时</strong> 的调试时间。</li>
</ul>
<p><strong>总结：</strong> 实现简易调试器在本学期中可节省约 <strong>50 小时</strong> 的调试时间。</p>
<hr>
<h3 id="rtfm理解科学查阅手册的方法">RTFM：理解科学查阅手册的方法</h3>
<p><strong>问题：</strong> 在 RISC-V ISA 手册中查阅以下问题所在的位置，并将需要阅读的范围写到实验报告中。
<strong>（1）riscv32 有哪几种指令格式？</strong></p>
<ul>
<li><strong>手册位置：</strong> 《The RISC-V Instruction Set Manual Volume I》第 15 页，2.2 Base Instruction Formats。</li>
</ul>
<p><img src="RISC-V_base_instruction_formats.png" alt="RISC-V base instruction formats"></p>
<ul>
<li><strong>解答：</strong> RISC-V 有四种基本的指令格式：
<ul>
<li>R-Type</li>
<li>I-Type</li>
<li>S-Type</li>
<li>U-Type</li>
</ul>
</li>
</ul>
<p><strong>（2）LUI 指令的行为是什么？</strong></p>
<ul>
<li><strong>手册位置：</strong> 《The RISC-V Instruction Set Manual Volume I》第 19 页，2.4 Integer Computational Instructions。</li>
</ul>
<p><img src="LUI.png" alt="LUI(load upper immediate)"></p>
<ul>
<li><strong>解答：</strong> LUI (Load Upper Immediate) 指令将一个 20 位的立即数加载到目标寄存器的高 20 位，同时将低 12 位清零。</li>
</ul>
<p><strong>（3）<code>mstatus</code> 寄存器的结构是怎么样的？</strong></p>
<ul>
<li><strong>手册位置：</strong> 《The RISC-V Instruction Set Manual Volume II》第 20 页，3.1.6 Machine Status Registers (<code>mstatus</code> and <code>mstatush</code>)。
<img src="Machine_Status_Registers.png" alt="Machine Status Registers"></li>
<li><strong>解答：</strong> <code>mstatus</code> 寄存器是机器模式下的状态寄存器，包含中断使能位、特权模式信息等关键控制位。</li>
</ul>
<hr>
<h3 id="shell-命令统计代码行数">Shell 命令统计代码行数</h3>
<h4 id="问题分析">问题分析</h4>
<p>我们需要统计 NEMU 项目中 PA1 完成后的代码行数，并与 PA0 基准进行比较，计算新增代码量。</p>
<h4 id="统计方法与结果">统计方法与结果</h4>
<p><strong>（1）PA1 完成后代码总行数（含空行）</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl"><span class="c1"># 执行命令</span>
</span></span><span class="line"><span class="cl">find -name <span class="s2">&#34;*.c&#34;</span> -o -name <span class="s2">&#34;*.h&#34;</span> <span class="p">|</span> xargs wc -l
</span></span></code></pre></div><p><strong>结果：267,533 行</strong>
<strong>（2）PA1 期间新增代码行数</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl"><span class="c1"># 切换到 PA0 分支获取基准数据</span>
</span></span><span class="line"><span class="cl">git checkout pa0
</span></span><span class="line"><span class="cl">find -name <span class="s2">&#34;*.c&#34;</span> -o -name <span class="s2">&#34;*.h&#34;</span> <span class="p">|</span> xargs wc -l
</span></span></code></pre></div><ul>
<li><strong>PA0 基准：</strong> 266,809 行</li>
<li><strong>PA1 完成：</strong> 267,533 行</li>
<li><strong>新增代码量：</strong> 267,533−266,809=724 行</li>
</ul>
<p><strong>（3）排除空行的有效代码统计</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl"><span class="c1"># 排除空行统计命令</span>
</span></span><span class="line"><span class="cl">find -name <span class="s2">&#34;*.c&#34;</span> -o -name <span class="s2">&#34;*.h&#34;</span> <span class="p">|</span> xargs grep -v <span class="s1">&#39;^$&#39;</span> <span class="p">|</span> wc -l
</span></span></code></pre></div><ul>
<li><strong>PA0 有效代码：</strong> 230,501 行</li>
<li><strong>PA1 有效代码：</strong> 231,191 行</li>
<li><strong>新增有效代码：</strong> 231,191−230,501=690 行</li>
</ul>
<p><strong>（4）Makefile 自动化配置</strong>
在 nemu/scripts/build.mk 文件中添加以下内容实现自动化统计：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Makefile" data-lang="Makefile"><span class="line"><span class="cl"><span class="nf">count</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    @find -name <span class="s2">&#34;*.c&#34;</span> -o -name <span class="s2">&#34;*.h&#34;</span> <span class="p">|</span> xargs wc -l
</span></span><span class="line"><span class="cl"><span class="nf">count-no-blank</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    @find -name <span class="s2">&#34;*.c&#34;</span> -o -name <span class="s2">&#34;*.h&#34;</span> <span class="p">|</span> xargs grep -v <span class="s1">&#39;^$&#39;</span> <span class="p">|</span> wc -l
</span></span></code></pre></div><p>使用方式：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl">make count          <span class="c1"># 统计总行数（含空行）</span>
</span></span><span class="line"><span class="cl">make count-no-blank  <span class="c1"># 统计有效代码行数</span>
</span></span></code></pre></div><h4 id="总结表格">总结表格</h4>
<table>
  <thead>
      <tr>
          <th>统计类型</th>
          <th>PA0 基准</th>
          <th>PA1 完成</th>
          <th>新增量</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>总行数（含空行）</strong></td>
          <td>266,809</td>
          <td>267,533</td>
          <td>+724</td>
      </tr>
      <tr>
          <td><strong>有效代码行数</strong></td>
          <td>230,501</td>
          <td>231,191</td>
          <td>+690</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="编译选项解释">编译选项解释</h3>
<p><strong>问题：</strong> 解释 <code>nemu/scripts/build.mk</code> 文件中的 <code>-Wall</code> 和 <code>-Werror</code> 编译选项。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nv">CFLAGS</span> <span class="o">:=</span> -O2 -MMD -Wall -Werror <span class="k">$(</span>INCLUDES<span class="k">)</span> <span class="k">$(</span>CFLAGS<span class="k">)</span>
</span></span></code></pre></div><p><strong>RTFM:</strong> <a href="https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html">Warning Options (Using the GNU Compiler Collection (GCC))</a>
<strong>（1）<code>-Wall</code> 选项</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">-Wall  <span class="c1"># Warning all(not really)</span>
</span></span></code></pre></div><ul>
<li><strong>作用：</strong> 开启 GCC 编译器的所有标准警告信息，帮助开发者发现代码中的潜在问题。</li>
<li><strong>包含的警告：</strong> 未使用的变量、可疑的类型转换、可能的空指针解引用等常见问题。</li>
<li><strong>优点：</strong> 在编译阶段提前发现许多常见的编程错误，提高代码质量。</li>
</ul>
<p><strong>（2）<code>-Werror</code> 选项</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">-Werror  <span class="c1"># Turn all warnings into errors.</span>
</span></span></code></pre></div><ul>
<li><strong>作用：</strong> 将编译过程中产生的所有警告都作为错误处理，导致编译失败。</li>
<li><strong>效果：</strong> 强制开发者必须解决所有警告，不能忽略任何潜在问题。</li>
<li><strong>优点：</strong> 确保代码库中不存在任何编译警告，提高代码的严谨性和可维护性。</li>
</ul>
<p>为什么需要使用 -Wall 和 -Werror？
通过强制处理所有警告，确保了代码的高质量。这有助于避免潜在的逻辑错误和运行时问题，从而降低未来的维护成本。</p>
<hr>
<h2 id="遇到的问题--看法以及趣事">遇到的问题 &amp; 看法以及趣事😊</h2>
<h3 id="神秘的0">神秘的➗0:</h3>
<p>在写表达式测试程序 <code>gen-expr.c</code> 有这么一道思考题：
<img src="Problem1.png" alt="Problem1">
<strong>STFM</strong>有：</p>
<ul>
<li>
<p>The ISO International Standard of the C Programming Language, draft <a href="http://chimera.roma1.infn.it/SP/COMMON/iso-iec-9899-1990.pdf">N1570</a> 
&ldquo;6.5.5 Multiplicative operators&rdquo;:</p>
<blockquote>
<p>5 The result of the / operator is the quotient from the division of the first operand by the second; the result of the % operator is the remainder. In both operations, if the value of the second operand is zero, the behavior is undefined.</p></blockquote>
</li>
<li>
<p>N1570 3. Terms, definitions, and symbols:</p>
</li>
</ul>
<blockquote>
<p><strong>3.4.3.</strong></p>
<p><strong>1 undefined behavior</strong><br>
behavior, upon use of a nonportable or erroneous program construct or of erroneous data, for which this International Standard imposes no requirements</p>
<p>2 NOTE Possible undefined behavior ranges from ignoring the situation completely with unpredictable results, to behaving during translation or program execution in a documented manner characteristic of the environment (with or without the issuance of a diagnostic message), to terminating a translation or execution (with the issuance of a diagnostic message).</p></blockquote>
<p>在C语言标准中，除零操作（如 <code>\0</code> 整型除法）被明确定义为<strong>未定义行为</strong>。当程序执行此类未定义行为时，其结果将是不可预测的，且编译器不提供任何保证。在编译阶段，编译器通常会发出警告：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">warning: division by zero is undefined <span class="o">[</span>-Wdivision-by-zero<span class="o">]</span>
</span></span></code></pre></div><p>运行编译后的程序通常会触发以下错误：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Floating point exception <span class="o">(</span>core dumped<span class="o">)</span>
</span></span></code></pre></div><p>基于这一错误特征，我首先想到可以利用程序框架提供的 <code>pclose()</code> 函数来检测除零异常。具体实现如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">fp</span> <span class="o">=</span> <span class="nf">popen</span><span class="p">(</span><span class="s">&#34;/tmp/.expr&#34;</span><span class="p">,</span> <span class="s">&#34;r&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nf">assert</span><span class="p">(</span><span class="n">fp</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">pclose_ret</span> <span class="o">=</span> <span class="nf">pclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">pclose_ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span><span class="o">--</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">continue</span><span class="p">;</span> <span class="c1">// 若运行失败，跳过当前迭代
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p><code>pclose()</code> 函数在关闭管道的同时，会返回所执行命令的退出状态：</p>
<ul>
<li>当程序正常运行时，<code>pclose()</code> 返回值为 <strong>0</strong></li>
<li>当出现除零等异常行为时，<code>pclose()</code> 返回值将<strong>不为 0</strong></li>
</ul>
<p>通过检查 <code>pclose_ret</code> 的值是否为 0，即可有效判断目标程序中是否发生了除零异常。理论上，这个问题应该到此解决了。然而在测试中出现了意想不到的麻烦：</p>
<ul>
<li>在将 <code>gen-expr.c</code> 生成的表达式作为输入测试 NEMU 表达式运算时，触发了 <code>expr()</code> 中的除零检测，导致测试中断。检查发现生成的表达式确实包含了除零操作。但令人困惑的是，同样的表达式在 C 程序中进行计算时却能得出结果，并没有触发上文提及的除零报错。<strong>STFW</strong>发现，除零行为在某些情况下,<strong>编译器会对常量表达式进行优化，直接忽略掉除0的部分</strong></li>
</ul>
<p>这说明通过<code>pclose()</code>的返回值我们并不能百分百排除生成除0的表达式。重新研究编译器对除0行为反馈的信息：出现除0行为时编译会有警告！我想到可以在修改程序框架的编译命令以实现将所有warning都视为error：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="nf">system</span><span class="p">(</span><span class="s">&#34;gcc /tmp/.code.c -Werror -o /tmp/.expr&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span><span class="o">--</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">continue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>终于解决了<code>gen-expr.c</code>的除0判断问题。</p>
<h3 id="运算符的结合性与无符号运算">运算符的结合性与无符号运算：</h3>
<p>在编写 <code>expr.c</code> 的过程中，我最初忽略了单目运算符与双目运算符在结合性上的重要差异。由于没有相应调整主运算符的更新规则，仅进行了简单的功能性测试，当基础表达式计算正常时，我便以为大功告成。
然而，在提交至 OJ 平台进行线上测试时，测试结果显示复杂表达式运算出现错误。花费了大半天时间排查，却始终未能定位到问题所在。直到完成并修复了表达式测试工具 <code>gen-expr.c</code> ，通过测试才发现错误与单目运算符相关。回想起之前的提示，我终于意识到单目运算符的结合性与双目运算符不同，随即修复了这一问题。
解决了结合性问题后，继续使用 <code>gen-expr.c</code> 进行测试，发现仍有计算错误。经过仔细检查，发现原来是我对无符号运算的理解存在偏差——错误地将 <code>eval()</code> 函数的返回值类型定义为 <code>unsigned int</code>，导致每次递归返回值均为无符号整型，从而引发了非预期的数值溢出，最终造成计算结果与真实值不符。
这次经历让我深刻体会到：在编程中绝不能偷懒，否则潜在的 Bug 终会在某一天找上门来。</p>
<hr>
<h2 id="思考题">思考题</h2>
<p><img src="Problem2.png" alt="">
使用函数调用在 <code>init_monitor()</code> 中的主要好处包括：</p>
<ol>
<li><strong>模块化</strong>：将初始化过程分解为独立的函数，每个函数负责一个特定任务，使代码结构更清晰。</li>
<li><strong>可读性</strong>：函数名能直观描述每个步骤的作用，比直接展开代码更易于理解。</li>
<li><strong>可维护性</strong>：如果某个初始化步骤需要修改，只需调整相应函数，避免影响其他代码。</li>
<li><strong>可重用性</strong>：这些函数可能在程序其他部分被重复使用，减少代码冗余。</li>
</ol>
<hr>
<p><img src="Problem3.png" alt="">
<code>cpu_exec()</code>声明如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">cpu_exec</span><span class="p">(</span><span class="kt">uint64_t</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//...
</span></span></span></code></pre></div><ol>
<li><strong>参数类型和转换：</strong> <code>cpu_exec</code> 函数接受 <strong><code>uint64_t</code></strong>（无符号 64 位整型）参数。</li>
<li><strong>$-1$ 的实际值：</strong> 传入的带符号 <code>-1</code> 会被转换为 <code>uint64_t</code> 的<strong>最大值</strong>，即 <strong>$2^{64}-1$</strong>（<code>0xFFFFFFFFFFFFFFFF</code>）。</li>
<li><strong>执行时间：</strong> 函数将被要求执行 <strong>$2^{64}-1$ 条指令</strong>。在实际环境中，这等价于**“无限执行”**，直到程序遇到 <code>NEMU_END</code>、<code>NEMU_ABORT</code> 或 <code>NEMU_QUIT</code> 等停止条件。</li>
<li>C99/C11 标准明确定义了有符号数到无符号数的转换规则，并非未定义行为。</li>
</ol>
<hr>
<p><img src="Problem4.png" alt="">
C语言标准库的 <strong>I/O 缓冲机制</strong>，对 <strong>标准输出流 (stdout)</strong> 默认采用的<strong>行缓冲</strong>模式。当 <code>printf()</code> 输出 <strong>换行符</strong> (<code>\n</code>) 时，缓冲区会被<strong>自动刷新 (flush)</strong>，输出立即显示到终端上。防止输出延迟，同时提高了可读性。</p>
<hr>
<p><img src="Problem5.png" alt="">
<strong>为什么要使用无符号类型？</strong></p>
<ol>
<li><strong>良定义行为：</strong> <strong>无符号数溢出</strong>是<strong>良定义行为</strong>（环绕到 $0$），而<strong>有符号数溢出</strong>是 C 语言的<strong>未定义行为（UB）</strong>，会导致程序行为不可预测。</li>
<li><strong>右移一致性：</strong> <strong>无符号数右移</strong>总是<strong>逻辑右移</strong>（左侧补 $0$），行为一致；而<strong>有符号数右移</strong>是<strong>实现定义的</strong>（可能是算术右移），行为不确定。</li>
<li><strong>表示地址/位模式：</strong> 内存地址、大小、位掩码等本质上都是非负数，无符号类型能更准确地表示这些概念。</li>
</ol>
<hr>
<p><strong>如果进行有符号运算，可能发生什么问题？</strong></p>
<ul>
<li><strong>程序奔溃/错误结果：</strong> 有符号溢出（UB）可能导致程序崩溃或生成不可靠的错误数据。</li>
<li><strong>位操作错误：</strong> 算术右移会保留符号位，干扰底层位操作（如掩码和提取）的预期结果。</li>
<li><strong>混合运算陷阱：</strong> 负数在与无符号数混合运算时会被提升为一个巨大的正数，导致错误的比较和判断。</li>
</ul>
<hr>
<p><img src="Problem6.png" alt="">
<strong><code>static</code> 在此处的含义:</strong>
<strong><code>static</code></strong> 限制了变量的<strong>可见范围</strong>（链接性），使其成为<strong>内部链接</strong>。该变量（如 <code>wp_pool</code>）仅能在其定义的<strong>源文件</strong>（编译单元）内部被访问和使用，对其他文件不可见。且具有<strong>静态存储期</strong>，程序整个运行期间都存在，只初始化一次。</p>
<hr>
<p>使用 <code>static</code> 的主要目的是实现<strong>封装</strong>和<strong>模块化</strong>：</p>
<ol>
<li><strong>信息隐藏</strong>：将 <code>wp_pool</code> 变量“私有化”给它所在的源文件使用，外部文件不能直接访问或意外修改，从而避免了意外的副作用。</li>
<li><strong>避免命名冲突</strong>：防止在大型项目中，其他源文件定义了同名的全局变量或函数，导致链接错误。</li>
</ol>
<hr>
<h2 id="实验心情">实验心情</h2>
<p>😊 感觉良好
复习了一些<code>C</code>语言的知识，锻炼了<strong>STFW</strong>与<strong>STFM</strong>的能力😊
希望后面能继续认真完成PA</p>

      </div>
    </div>
    
    
      <footer class="post-footer">
        <div class="post-tags">
          
            <a href="/tags/ics/" class="tag-link">#ICS</a>
          
            <a href="/tags/pa/" class="tag-link">#PA</a>
          
        </div>
      </footer>
    
  </div>
</article>

      </section>
    </div>
  </main>
  
  <footer class="footer" data-liquid-glass="footer">
  <div class="container">
    <div class="footer-inner">
      <div class="footer-info">
        <p class="copyright">
          © 2025 - 2026 OCTOPUS
        </p>
        <p class="powered">
          Powered by <a href="https://gohugo.io" target="_blank">Hugo</a> & Designed By Myself
        </p>
      </div>
      
    </div>
  </div>
</footer>

  
  
  <button class="fab-sidebar-toggle" id="fabSidebarToggle" aria-label="打开侧边栏">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <line x1="3" y1="12" x2="21" y2="12"/>
      <line x1="3" y1="6" x2="21" y2="6"/>
      <line x1="3" y1="18" x2="21" y2="18"/>
    </svg>
  </button>
  
  
  <div class="sidebar-drawer" id="sidebarDrawer">
    <div class="sidebar-drawer-header">
      <span class="sidebar-drawer-title">导航</span>
      <button class="sidebar-drawer-close" id="sidebarDrawerClose" aria-label="关闭">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    <div class="sidebar-drawer-content">
      <div class="sidebar-inner">
  
  <div class="sidebar-card blog-title-card">
    <a href="/" class="blog-title-link">
      <span class="blog-title-text">DIMS</span>
    </a>
  </div>

  <div class="sidebar-card profile-card">
    <div class="avatar">
      <img src="https://avatars.githubusercontent.com/u/204014295?v=4" alt="OCTOPUS">
    </div>
    <div class="profile-info">
      <h3>OCTOPUS</h3>
      <p>热爱技术，热爱生活。</p>
    </div>
    <div class="profile-meta">
      <span>Since 2025</span>
      
        <span>github</span>
      
    </div>
  </div>

  
  <div class="sidebar-card">
    <h4 class="sidebar-title">
      <a href="/categories/" class="sidebar-title-link">
        <span class="title-icon">📁</span>
        <span>分类</span>
      </a>
    </h4>
    <ul class="sidebar-list">
      
      <li>
        <a href="/categories/%E6%8A%A5%E5%91%8A/" class="sidebar-link">
          <span class="link-name">报告</span>
          <span class="count">4</span>
        </a>
      </li>
      
    </ul>
  </div>
  

  
  <div class="sidebar-card">
    <h4 class="sidebar-title">
      <a href="/tags/" class="sidebar-title-link">
        <span class="title-icon">🏷️</span>
        <span>标签</span>
      </a>
    </h4>
    <div class="tag-cloud-compact">
      
        <a href="/tags/ics/" class="tag-item-compact" title="4 篇文章">
          ICS
        </a>
      
        <a href="/tags/pa/" class="tag-item-compact" title="4 篇文章">
          PA
        </a>
      
    </div>
  </div>
  

  
  <div class="sidebar-card">
    <h4 class="sidebar-title">
      <span class="title-icon">📝</span>
      <span>最近文章</span>
    </h4>
    <ul class="sidebar-list recent-posts">
      
      <li>
        <a href="/2026/02/09/ics_pa4-%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/" class="sidebar-link recent-post-link">
          <span class="link-name recent-post-title">ICS_PA4 实验报告</span>
          <span class="date">02-09</span>
        </a>
      </li>
      
      <li>
        <a href="/2025/12/12/ics_pa3-%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/" class="sidebar-link recent-post-link">
          <span class="link-name recent-post-title">ICS_PA3 实验报告</span>
          <span class="date">12-12</span>
        </a>
      </li>
      
      <li>
        <a href="/2025/11/11/ics_pa2-%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/" class="sidebar-link recent-post-link">
          <span class="link-name recent-post-title">ICS_PA2 实验报告</span>
          <span class="date">11-11</span>
        </a>
      </li>
      
      <li>
        <a href="/2025/09/24/ics_pa1-%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/" class="sidebar-link recent-post-link">
          <span class="link-name recent-post-title">ICS_PA1 实验报告</span>
          <span class="date">09-24</span>
        </a>
      </li>
      
    </ul>
  </div>
  
</div>

    </div>
  </div>
  
  
  <div class="sidebar-overlay" id="sidebarOverlay"></div>
  
  
  
  <script src="/js/snow-ground.min.js"></script>
  
  <script src="/js/liquidGlass.min.js"></script>
  
  <script src="/js/main.min.js"></script>
  
  
    
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        if (typeof renderMathInElement !== 'undefined') {
          renderMathInElement(document.body, {
            delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\[', right: '\\]', display: true},
              {left: '\\(', right: '\\)', display: false}
            ],
            throwOnError: false
          });
        }
      });
    </script>
  
</body>
</html>
