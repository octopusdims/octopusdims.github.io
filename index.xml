<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>DIMS</title><link>https://octopusdims.github.io/</link><description>Recent content on DIMS</description><generator>Hugo</generator><language>zh-CN</language><lastBuildDate>Mon, 23 Feb 2026 19:00:00 +0800</lastBuildDate><atom:link href="https://octopusdims.github.io/index.xml" rel="self" type="application/rss+xml"/><item><title/><link>https://octopusdims.github.io/moments/2026-02-23-ye-huo/</link><pubDate>Mon, 23 Feb 2026 19:00:00 +0800</pubDate><guid>https://octopusdims.github.io/moments/2026-02-23-ye-huo/</guid><description>&lt;p>æ„Ÿè§‰æœ‰è‚¡é‡Žç«ðŸ”¥ðŸ”¥åœ¨ä½ èº«ä½“é‡Œç‡ƒçƒ§â¤ï¸â€ðŸ”¥â¤ï¸â€ðŸ”¥
æŠŠæˆ‘ç¼ ç»•ðŸ¥ºðŸ¥ºå¸¦æˆ‘ç¦»å¼€è¿™ä¸ªåœ°æ–¹ðŸƒðŸƒâ€â™€ï¸&lt;/p></description></item><item><title>ICS_PA4 å®žéªŒæŠ¥å‘Š</title><link>https://octopusdims.github.io/2026/02/09/ics_pa4-%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/</link><pubDate>Mon, 09 Feb 2026 22:45:00 +0000</pubDate><guid>https://octopusdims.github.io/2026/02/09/ics_pa4-%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/</guid><description>&lt;h2 id="å®žéªŒè¿›åº¦">å®žéªŒè¿›åº¦&lt;/h2>
&lt;p>æˆ‘å·²å®Œæˆ PA4 çš„&lt;strong>æ‰€æœ‰å¿…åšå†…å®¹&lt;/strong>ï¼ˆè™šå®žäº¤é”™çš„é­”æ³•ã€åˆ†æ—¶å¤šä»»åŠ¡ï¼‰ï¼ŒæˆåŠŸå®žçŽ°äº†åˆ†é¡µæœºåˆ¶ã€è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¹¶èƒ½å¤Ÿè®©&lt;strong>ä»™å‰‘å¥‡ä¾ ä¼ &lt;/strong>å’Œ &lt;strong>Hello&lt;/strong> ç¨‹åºåŒæ—¶åœ¨ Nanos-lite ä¸Šåˆ†æ—¶è¿è¡Œã€‚&lt;/p>
&lt;hr>
&lt;h2 id="å¿…ç­”é¢˜">å¿…ç­”é¢˜&lt;/h2>
&lt;h3 id="åˆ†æ—¶å¤šä»»åŠ¡çš„å…·ä½“è¿‡ç¨‹">åˆ†æ—¶å¤šä»»åŠ¡çš„å…·ä½“è¿‡ç¨‹&lt;/h3>
&lt;p>&lt;strong>é—®é¢˜ï¼š&lt;/strong> è¯·ç»“åˆä»£ç , è§£é‡Šåˆ†é¡µæœºåˆ¶å’Œç¡¬ä»¶ä¸­æ–­æ˜¯å¦‚ä½•æ”¯æ’‘ä»™å‰‘å¥‡ä¾ ä¼ å’Œhelloç¨‹åºåœ¨æˆ‘ä»¬çš„è®¡ç®—æœºç³»ç»Ÿ(Nanos-lite, AM, NEMU)ä¸­åˆ†æ—¶è¿è¡Œçš„ã€‚&lt;/p>
&lt;p>&lt;strong>Solution:&lt;/strong>&lt;/p>
&lt;p>è¿™ä¸€è¿‡ç¨‹æ˜¯&lt;strong>æ—¶é’Ÿä¸­æ–­é©±åŠ¨&lt;/strong>ä¸Ž&lt;strong>è™šæ‹Ÿå†…å­˜éš”ç¦»&lt;/strong>å…±åŒä½œç”¨çš„ç»“æžœã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶æ‹†è§£ä¸ºä»¥ä¸‹å‡ ä¸ªå…³é”®æ­¥éª¤ï¼š&lt;/p>
&lt;h4 id="åˆå§‹å‡†å¤‡ä¸ŽåŠ è½½">åˆå§‹å‡†å¤‡ä¸ŽåŠ è½½&lt;/h4>
&lt;p>åœ¨ &lt;code>init_proc()&lt;/code> ä¸­ï¼ˆ&lt;code>nanos-lite/src/proc.c:34-60&lt;/code>ï¼‰ï¼ŒNanos-lite åŠ è½½äº†ä»™å‰‘å¥‡ä¾ ä¼ ã€Helloã€Menu å’Œ Nterm å››ä¸ªç¨‹åºã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// pcb[0]: hello 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nf">context_kload&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">pcb&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">hello_fun&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;hello&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// pcb[1]: ä»™å‰‘å¥‡ä¾ ä¼  (PAL)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kt">char&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">argv_pal&lt;/span>&lt;span class="p">[]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s">&amp;#34;/bin/pal&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;--skip&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">char&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">envp_pal&lt;/span>&lt;span class="p">[]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s">&amp;#34;PATH=/bin&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">context_uload&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">pcb&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="s">&amp;#34;/bin/pal&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">argv_pal&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">envp_pal&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>è™šæ‹Ÿåœ°å€ç©ºé—´åˆ›å»ºï¼š&lt;/strong> &lt;code>context_uload&lt;/code> è°ƒç”¨ &lt;code>protect()&lt;/code>ï¼ˆ&lt;code>am/src/riscv/nemu/vme.c:47-54&lt;/code>ï¼‰ï¼Œä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ç‹¬ç«‹çš„é¡µç›®å½•è¡¨ï¼ˆPage Directoryï¼‰å¹¶å¤åˆ¶å†…æ ¸é¡µè¡¨æ˜ å°„ã€‚&lt;/li>
&lt;li>&lt;strong>ä»£ç åŠ è½½ï¼š&lt;/strong> Loaderï¼ˆ&lt;code>nanos-lite/src/loader.c:49-100&lt;/code>ï¼‰å°† ELF æ–‡ä»¶åŠ è½½åˆ°å„è‡ªè™šæ‹Ÿåœ°å€ç©ºé—´ã€‚é€šè¿‡ &lt;code>map()&lt;/code> å‡½æ•°å»ºç«‹è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†é¡µå¸§çš„æ˜ å°„ï¼Œç¡®ä¿ä¸åŒè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€æ˜ å°„åˆ°ä¸åŒçš„ç‰©ç†å†…å­˜é¡µã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="ä¸­æ–­è§¦å‘-the-trigger">ä¸­æ–­è§¦å‘ (The Trigger)&lt;/h4>
&lt;p>å½“ä»™å‰‘å¥‡ä¾ ä¼ æ­£åœ¨ CPU ä¸Šè¿è¡Œæ—¶ï¼ŒNEMU çš„æ—¶é’Ÿè®¾å¤‡å®šæœŸäº§ç”Ÿä¸­æ–­ä¿¡å·ï¼ˆ&lt;code>mcause = 0x80000007&lt;/code>ï¼‰ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ç¡¬ä»¶å“åº”ï¼š&lt;/strong> ç¡¬ä»¶æ£€æµ‹åˆ°ä¸­æ–­ï¼Œä¿å­˜å½“å‰ PC åˆ° &lt;code>mepc&lt;/code>ï¼Œè®¾ç½® &lt;code>mcause&lt;/code>ï¼Œå¹¶è·³è½¬åˆ° &lt;code>__am_asm_trap&lt;/code>ï¼ˆä½äºŽ &lt;code>am/src/riscv/nemu/trap.S:44&lt;/code>ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="ä¿å­˜çŽ°åœº-context-saving">ä¿å­˜çŽ°åœº (Context Saving)&lt;/h4>
&lt;p>&lt;code>trap.S&lt;/code>ï¼ˆ&lt;code>am/src/riscv/nemu/trap.S:44-94&lt;/code>ï¼‰å°†ä»™å‰‘å¥‡ä¾ ä¼ å½“å‰çš„é€šç”¨å¯„å­˜å™¨ã€CSR å¯„å­˜å™¨ï¼ˆåŒ…æ‹¬ &lt;code>mstatus&lt;/code>, &lt;code>mepc&lt;/code> ç­‰ï¼‰åŽ‹å…¥å½“å‰è¿›ç¨‹çš„å†…æ ¸æ ˆä¸­ï¼Œå½¢æˆä¸€ä¸ª &lt;code>Context&lt;/code> ç»“æž„ä½“ã€‚&lt;/p></description></item><item><title>ICS_PA3 å®žéªŒæŠ¥å‘Š</title><link>https://octopusdims.github.io/2025/12/12/ics_pa3-%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/</link><pubDate>Fri, 12 Dec 2025 13:16:23 +0000</pubDate><guid>https://octopusdims.github.io/2025/12/12/ics_pa3-%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/</guid><description>&lt;h2 id="å®žéªŒè¿›åº¦">å®žéªŒè¿›åº¦&lt;/h2>
&lt;p>æˆ‘å·²å®Œæˆ PA3 çš„&lt;strong>æ‰€æœ‰å†…å®¹&lt;/strong>ï¼Œå¹¶é€šè¿‡äº†&lt;strong>æ‰€æœ‰çš„æµ‹è¯•æ ·ä¾‹&lt;/strong>ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="å¿…ç­”é¢˜">å¿…ç­”é¢˜&lt;/h2>
&lt;h3 id="ç†è§£ä¸Šä¸‹æ–‡ç»“æž„ä½“çš„å‰ä¸–ä»Šç”Ÿ">ç†è§£ä¸Šä¸‹æ–‡ç»“æž„ä½“çš„å‰ä¸–ä»Šç”Ÿ&lt;/h3>
&lt;p>&lt;strong>é—®é¢˜ï¼š&lt;/strong> ä½ ä¼šåœ¨&lt;code>__am_irq_handle()&lt;/code>ä¸­çœ‹åˆ°æœ‰ä¸€ä¸ªä¸Šä¸‹æ–‡ç»“æž„æŒ‡é’ˆ&lt;code>c&lt;/code>, &lt;code>c&lt;/code>æŒ‡å‘çš„ä¸Šä¸‹æ–‡ç»“æž„ç©¶ç«Ÿåœ¨å“ªé‡Œ? è¿™ä¸ªä¸Šä¸‹æ–‡ç»“æž„åˆæ˜¯æ€Žä¹ˆæ¥çš„? å…·ä½“åœ°, è¿™ä¸ªä¸Šä¸‹æ–‡ç»“æž„æœ‰å¾ˆå¤šæˆå‘˜, æ¯ä¸€ä¸ªæˆå‘˜ç©¶ç«Ÿåœ¨å“ªé‡Œèµ‹å€¼çš„? &lt;code>$ISA-nemu.h&lt;/code>, &lt;code>trap.S&lt;/code>, ä¸Šè¿°è®²ä¹‰æ–‡å­—, ä»¥åŠä½ åˆšåˆšåœ¨NEMUä¸­å®žçŽ°çš„æ–°æŒ‡ä»¤, è¿™å››éƒ¨åˆ†å†…å®¹åˆæœ‰ä»€ä¹ˆè”ç³»?&lt;/p>
&lt;p>&lt;strong>Solution:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="n">Context&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// TODO: fix the order of these members to match trap.S
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">uintptr_t&lt;/span> &lt;span class="n">gpr&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">NR_REGS&lt;/span>&lt;span class="p">];&lt;/span> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">uintptr_t&lt;/span> &lt;span class="n">mcause&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">uintptr_t&lt;/span> &lt;span class="n">mstatus&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">uintptr_t&lt;/span> &lt;span class="n">mepc&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">pdir&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h4 id="ä¸Šä¸‹æ–‡ç»“æž„-c-çš„ä½ç½®å’Œæ¥æº">ä¸Šä¸‹æ–‡ç»“æž„ $c$ çš„ä½ç½®å’Œæ¥æº&lt;/h4>
&lt;ol>
&lt;li>ä¸Šä¸‹æ–‡ç»“æž„ $c$ æŒ‡å‘çš„ç»“æž„ä½“å®žä¾‹ä¿å­˜åœ¨&lt;strong>å½“å‰çº¿ç¨‹çš„å†…æ ¸æ ˆä¸Š&lt;/strong>ã€‚&lt;/li>
&lt;li>å®ƒæ˜¯ç”± NEMU çš„ä¸­æ–­/å¼‚å¸¸å¤„ç†æ±‡ç¼–å…¥å£æ–‡ä»¶ &lt;strong>&lt;code>trap.S&lt;/code>&lt;/strong> åœ¨ä¸­æ–­/å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œé€šè¿‡ä¸€ç³»åˆ—æ±‡ç¼–æŒ‡ä»¤ï¼ˆä¸»è¦æ˜¯åŽ‹æ ˆæ“ä½œï¼‰åœ¨æ ˆä¸ŠåŠ¨æ€åˆ›å»ºçš„ã€‚&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h4 id="ä¸Šä¸‹æ–‡ç»“æž„æˆå‘˜çš„èµ‹å€¼ä½ç½®">ä¸Šä¸‹æ–‡ç»“æž„æˆå‘˜çš„èµ‹å€¼ä½ç½®&lt;/h4>
&lt;p>æ‰€æœ‰æˆå‘˜çš„èµ‹å€¼éƒ½å‘ç”Ÿåœ¨ &lt;strong>&lt;code>trap.S&lt;/code>&lt;/strong> æ–‡ä»¶ä¸­ï¼š&lt;/p>
&lt;h5 id="21-é€šç”¨å¯„å­˜å™¨-gprnr_regs">2.1. é€šç”¨å¯„å­˜å™¨ (&lt;code>gpr[NR_REGS]&lt;/code>)&lt;/h5>
&lt;ul>
&lt;li>&lt;strong>èµ‹å€¼ä½ç½®ï¼š&lt;/strong> &lt;code>trap.S&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;strong>èµ‹å€¼æ–¹å¼ï¼š&lt;/strong> é€šè¿‡ä¸€ç³»åˆ— &lt;code>sw&lt;/code> (store word) æˆ– &lt;code>sd&lt;/code> (store doubleword) æŒ‡ä»¤ï¼ˆå–å†³äºŽ $32/64$ ä½ï¼‰ï¼Œå°†é€šç”¨å¯„å­˜å™¨ $x1$ åˆ° $x31$ï¼ˆ$x0$ å¯„å­˜å™¨ä¸º $0$ï¼Œé€šå¸¸ä¸éœ€ä¿å­˜æˆ–ä»¥ $0$ å ä½ï¼‰çš„å€¼ä¾æ¬¡åŽ‹å…¥æ ˆä¸­ã€‚&lt;/li>
&lt;li>&lt;strong>å…³é”®ç‚¹ï¼š&lt;/strong> è¿™æ˜¯ä¿å­˜çŽ°åœºçš„ç¬¬ä¸€æ­¥ï¼Œå ç”¨ $Context$ ç»“æž„ä½“ä¸­æœ€å¤§çš„è¿žç»­å†…å­˜å—ã€‚&lt;/li>
&lt;/ul>
&lt;h5 id="22-ç‰¹æƒç³»ç»Ÿå¯„å­˜å™¨-mcause-mstatus-mepc">2.2. ç‰¹æƒ/ç³»ç»Ÿå¯„å­˜å™¨ (&lt;code>mcause&lt;/code>, &lt;code>mstatus&lt;/code>, &lt;code>mepc&lt;/code>)&lt;/h5>
&lt;p>è¿™ä¸‰ä¸ªå¯„å­˜å™¨æ˜¯ RISC-V å¼‚å¸¸å¤„ç†çš„æ ¸å¿ƒï¼Œå®ƒä»¬ç”±ç¡¬ä»¶å’Œè½¯ä»¶ååŒèµ‹å€¼ï¼š&lt;/p></description></item><item><title>ICS_PA2 å®žéªŒæŠ¥å‘Š</title><link>https://octopusdims.github.io/2025/11/11/ics_pa2-%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/</link><pubDate>Tue, 11 Nov 2025 14:58:52 +0000</pubDate><guid>https://octopusdims.github.io/2025/11/11/ics_pa2-%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/</guid><description>&lt;h2 id="å®žéªŒè¿›åº¦">å®žéªŒè¿›åº¦&lt;/h2>
&lt;p>æˆ‘å·²å®Œæˆ PA2 çš„&lt;strong>æ‰€æœ‰å†…å®¹&lt;/strong>ï¼Œå¹¶é€šè¿‡äº†&lt;strong>æ‰€æœ‰çš„æµ‹è¯•æ ·ä¾‹&lt;/strong>ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="å¿…ç­”é¢˜">å¿…ç­”é¢˜&lt;/h2>
&lt;h3 id="ä¸åœè®¡ç®—çš„æœºå™¨">ä¸åœè®¡ç®—çš„æœºå™¨&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-C" data-lang="C">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;stdint.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#define NREG 4
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#define NMEM 16
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å®šä¹‰æŒ‡ä»¤æ ¼å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">typedef&lt;/span> &lt;span class="k">union&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">struct&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="kt">uint8_t&lt;/span> &lt;span class="nl">rs&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nl">rt&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nl">op&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="n">rtype&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">struct&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="kt">uint8_t&lt;/span> &lt;span class="nl">addr&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">4&lt;/span> &lt;span class="p">,&lt;/span> &lt;span class="nl">op&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="n">mtype&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">uint8_t&lt;/span> &lt;span class="n">inst&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span> &lt;span class="kt">inst_t&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#define DECODE_R(inst) uint8_t rt = (inst).rtype.rt, rs = (inst).rtype.rs
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#define DECODE_M(inst) uint8_t addr = (inst).mtype.addr
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">uint8_t&lt;/span> &lt;span class="n">pc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// PC, Cè¯­è¨€ä¸­æ²¡æœ‰4ä½çš„æ•°æ®ç±»åž‹, æˆ‘ä»¬é‡‡ç”¨8ä½ç±»åž‹æ¥è¡¨ç¤º
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kt">uint8_t&lt;/span> &lt;span class="n">R&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">NREG&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{};&lt;/span> &lt;span class="c1">// å¯„å­˜å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kt">uint8_t&lt;/span> &lt;span class="n">M&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">NMEM&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="c1">// å†…å­˜, å…¶ä¸­åŒ…å«ä¸€ä¸ªè®¡ç®—z = x + yçš„ç¨‹åº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">b11100110&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// load 6# | R[0] &amp;lt;- M[y]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">b00000100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// mov r1, r0 | R[1] &amp;lt;- R[0]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">b11100101&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// load 5# | R[0] &amp;lt;- M[x]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">b00010001&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// add r0, r1 | R[0] &amp;lt;- R[0] + R[1]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">b11110111&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// store 7# | M[z] &amp;lt;- R[0]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">b00010000&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// x = 16
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">b00100001&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// y = 33
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">b00000000&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// z = 0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="n">halt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// ç»“æŸæ ‡å¿—
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ‰§è¡Œä¸€æ¡æŒ‡ä»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="nf">exec_once&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">inst_t&lt;/span> &lt;span class="n">this&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">inst&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">M&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">pc&lt;/span>&lt;span class="p">];&lt;/span> &lt;span class="c1">// å–æŒ‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">switch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">rtype&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">op&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ“ä½œç è¯‘ç  æ“ä½œæ•°è¯‘ç  æ‰§è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">case&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="nl">b0000&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nf">DECODE_R&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">this&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="n">R&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">rt&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">R&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">rs&lt;/span>&lt;span class="p">];&lt;/span> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="nl">b0001&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nf">DECODE_R&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">this&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="n">R&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">rt&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">R&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">rs&lt;/span>&lt;span class="p">];&lt;/span> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="nl">b1110&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nf">DECODE_M&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">this&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="n">R&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">M&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">addr&lt;/span>&lt;span class="p">];&lt;/span> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="nl">b1111&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nf">DECODE_M&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">this&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="n">M&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">addr&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">R&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">];&lt;/span> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">default&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Invalid instruction with opcode = %x, halting...&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">rtype&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">op&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">halt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pc&lt;/span> &lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// æ›´æ–°PC
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">exec_once&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">halt&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;The result of 16 + 33 is %d&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="p">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>é—®é¢˜ï¼š&lt;/strong> ç”»å‡ºåœ¨YEMUä¸Šæ‰§è¡Œçš„åŠ æ³•ç¨‹åºçš„çŠ¶æ€æœº&lt;/p></description></item><item><title>ICS_PA1 å®žéªŒæŠ¥å‘Š</title><link>https://octopusdims.github.io/2025/09/24/ics_pa1-%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/</link><pubDate>Wed, 24 Sep 2025 19:04:44 +0000</pubDate><guid>https://octopusdims.github.io/2025/09/24/ics_pa1-%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/</guid><description>&lt;h2 id="å®žéªŒè¿›åº¦">å®žéªŒè¿›åº¦&lt;/h2>
&lt;p>æˆ‘å·²å®Œæˆ PA1 çš„&lt;strong>æ‰€æœ‰å†…å®¹&lt;/strong>ï¼Œå¹¶é€šè¿‡äº†&lt;strong>æ‰€æœ‰çš„æµ‹è¯•æ ·ä¾‹&lt;/strong>ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="å¿…ç­”é¢˜">å¿…ç­”é¢˜&lt;/h2>
&lt;h3 id="ç¨‹åºæ˜¯ä¸ªçŠ¶æ€æœº">ç¨‹åºæ˜¯ä¸ªçŠ¶æ€æœº&lt;/h3>
&lt;p>&lt;strong>é—®é¢˜ï¼š&lt;/strong> ç”»å‡ºè®¡ç®— 1+2+&amp;hellip;+100 çš„ç¨‹åºçš„çŠ¶æ€æœºã€‚&lt;/p>
&lt;p>&lt;strong>Solution:&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">// PC: instruction | // label: statement
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0: mov r1, 0 | pc0: r1 = 0;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1: mov r2, 0 | pc1: r2 = 0;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2: addi r2, r2 , 1 | pc2: r2 = r2 + 1;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3: add r1, r1 , r2 | pc3: r1 = r1 + r2;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4: cmp r2 100 | pc4: compare r2 with 100;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5: jl 2 | pc5: if r2 &amp;lt; 100, jump to pc2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¨‹åºçš„çŠ¶æ€æœºå¦‚ä¸‹ï¼š&lt;/p></description></item><item><title>About</title><link>https://octopusdims.github.io/about/</link><pubDate>Wed, 01 Jan 2025 00:00:00 +0800</pubDate><guid>https://octopusdims.github.io/about/</guid><description>&lt;h1 id="about-me">About Me&lt;/h1>
&lt;p>&lt;strong>NJUðŸ™&lt;/strong>&lt;/p></description></item><item><title>Archives</title><link>https://octopusdims.github.io/archives/</link><pubDate>Wed, 01 Jan 2025 00:00:00 +0800</pubDate><guid>https://octopusdims.github.io/archives/</guid><description/></item><item><title>Gallery</title><link>https://octopusdims.github.io/gallery/</link><pubDate>Wed, 01 Jan 2025 00:00:00 +0800</pubDate><guid>https://octopusdims.github.io/gallery/</guid><description/></item></channel></rss>