document.addEventListener("DOMContentLoaded",function(){const g=document.querySelector(".search-toggle"),n=document.getElementById("searchModal"),a=document.getElementById("searchInput"),b=document.getElementById("searchClose"),s=document.getElementById("searchResults");let O=[],t=-1;async function k(){try{const e=await fetch("/search.json");O=await e.json()}catch(e){console.error("Failed to load search data:",e)}}function j(){n.classList.add("active"),a.value="",a.focus(),s.innerHTML="",t=-1,document.body.style.overflow="hidden"}function l(){n.classList.remove("active"),document.body.style.overflow=""}function S(e){if(!e.trim()){s.innerHTML="";return}const t=e.toLowerCase().trim(),n=O.filter(e=>{const n=e.title&&e.title.toLowerCase().includes(t),s=e.content&&e.content.toLowerCase().includes(t);return n||s}).slice(0,10);F(n,t)}function v(e,t){if(!e)return"";const n=new RegExp(`(${t})`,"gi");return e.replace(n,"<mark>$1</mark>")}function F(e,n){if(e.length===0){s.innerHTML='<div class="search-no-results">没有找到相关文章</div>';return}const o=e.map((e,t)=>{const s=e.content?e.content.substring(0,150)+"...":"";return`
        <a href="${e.url}" class="search-result-item" data-index="${t}">
          <div class="search-result-title">${v(e.title,n)}</div>
          <div class="search-result-excerpt">${v(s,n)}</div>
          <div class="search-result-meta">
            <span>${e.date||""}</span>
            ${e.categories?`<span>${e.categories.join(", ")}</span>`:""}
          </div>
        </a>
      `}).join("");s.innerHTML=o,t=-1}function _(){const e=s.querySelectorAll(".search-result-item");e.forEach((e,n)=>{e.classList.toggle("selected",n===t)}),t>=0&&e[t]&&e[t].scrollIntoView({block:"nearest"})}if(g&&g.addEventListener("click",j),b&&b.addEventListener("click",l),n&&n.addEventListener("click",function(e){e.target===n&&l()}),a){let e;a.addEventListener("input",function(){clearTimeout(e),e=setTimeout(()=>{S(this.value)},300)}),a.addEventListener("keydown",function(e){const n=s.querySelectorAll(".search-result-item");switch(e.key){case"Escape":l();break;case"ArrowDown":e.preventDefault(),t=Math.min(t+1,n.length-1),_();break;case"ArrowUp":e.preventDefault(),t=Math.max(t-1,-1),_();break;case"Enter":e.preventDefault(),t>=0&&n[t]?window.location.href=n[t].href:n.length>0&&(window.location.href=n[0].href);break}})}document.addEventListener("keydown",function(e){(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),n.classList.contains("active")?l():j())}),k(),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=document.querySelector(this.getAttribute("href"));t&&t.scrollIntoView({behavior:"smooth",block:"start"})})});const r=document.querySelector(".hero-subtitle");r&&document.querySelector(".posts-section")&&(r.style.cursor="pointer",r.addEventListener("click",()=>{document.querySelector(".posts-section").scrollIntoView({behavior:"smooth",block:"start"})}),r.title="Click to scroll to posts"),document.querySelectorAll(".tabs").forEach(e=>{const n=e.querySelectorAll(".nav-tabs .tab"),t=e.querySelectorAll(".tab-contents .tab-item-content");n.forEach((e,s)=>{e.addEventListener("click",function(){n.forEach(e=>e.classList.remove("active")),t.forEach(e=>e.classList.remove("active")),this.classList.add("active"),t[s]&&(void t[s].offsetWidth,t[s].classList.add("active"))})})});function M(e){const t=document.createElement("button");return t.className="code-copy-btn",t.type="button",t.innerHTML=`
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
      </svg>
      <span>Copy</span>
    `,t.addEventListener("click",async()=>{const n=e.textContent;try{await navigator.clipboard.writeText(n),t.innerHTML=`
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          <span>Copied!</span>
        `,t.classList.add("copied"),setTimeout(()=>{t.innerHTML=`
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
            </svg>
            <span>Copy</span>
          `,t.classList.remove("copied")},2e3)}catch(e){console.error("Failed to copy:",e)}}),t}function h(e,t){const n=document.createElement("div");n.className="code-toolbar";const s=document.createElement("span");s.className="code-lang-label",s.textContent=(e||"code").toUpperCase();const o=M(t);return n.appendChild(s),n.appendChild(o),n}document.querySelectorAll(".post-content figure.highlight").forEach(e=>{const s=Array.from(e.classList),o=s.find(e=>e!=="highlight"),t=e.querySelector("table"),n=e.querySelector("pre code");if(!t||!n)return;const i=h(o,n);e.insertBefore(i,t),e.classList.add("has-toolbar")}),document.querySelectorAll(".post-content pre:not(figure.highlight pre)").forEach(e=>{const n=e.querySelector("code");if(!n)return;const s=Array.from(n.classList).find(e=>e.startsWith("language-")),o=s?s.replace("language-",""):e.getAttribute("data-lang")||"code",t=document.createElement("figure");t.className="code-block",e.parentNode.insertBefore(t,e),t.appendChild(e);const i=h(o,n);t.insertBefore(i,e)}),document.body.classList.add("loaded");const u=document.querySelectorAll(".post-card");if(u.length>0){const e=new IntersectionObserver(t=>{t.forEach((t)=>{if(t.isIntersecting){const n=Array.from(u).indexOf(t.target);setTimeout(()=>{t.target.classList.add("animate-in")},n*100),e.unobserve(t.target)}})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});u.forEach(t=>{e.observe(t)})}const e=document.getElementById("fabSidebarToggle"),i=document.getElementById("sidebarDrawer"),o=document.getElementById("sidebarOverlay"),m=document.getElementById("sidebarDrawerClose");function E(){i&&i.classList.add("active"),o&&o.classList.add("active"),e&&e.classList.add("hidden"),document.body.style.overflow="hidden"}function d(){i&&i.classList.remove("active"),o&&o.classList.remove("active"),e&&e.classList.remove("hidden"),document.body.style.overflow=""}if(m&&m.addEventListener("click",d),o&&o.addEventListener("click",d),document.addEventListener("keydown",function(e){e.key==="Escape"&&i&&i.classList.contains("active")&&d()}),e){let s=!1,o=!1,i,a,r=0,c=0,t=0,n=0;function C(){r=0,c=0,t=0,n=0,e.style.transform="translate(0, 0)",e.style.right="",e.style.top=""}let l;window.addEventListener("resize",function(){clearTimeout(l),l=setTimeout(C,250)});function x(t){o=!1,t.type==="touchstart"?(i=t.touches[0].clientX,a=t.touches[0].clientY):(i=t.clientX,a=t.clientY),s=!0,e.style.transition="none",t.preventDefault()}function w(l){if(!s)return;let f,u;l.type==="touchmove"?(f=l.touches[0].clientX,u=l.touches[0].clientY):(f=l.clientX,u=l.clientY);const C=f-i,x=u-a;(Math.abs(C)>5||Math.abs(x)>5)&&(o=!0),t=r+C,n=c+x;const g=e.getBoundingClientRect(),k=g.width,E=g.height,v=getComputedStyle(e),d=parseFloat(v.right)||20,p=parseFloat(v.top)||window.innerHeight*.35,A=-t,b=d+A,j=p+n,y=window.innerWidth-k-10,_=window.innerHeight-E-10,w=10,O=10;let m=t,h=n;b<w?m=-(w-d):b>y&&(m=-(y-d)),j<O?h=O-p:j>_&&(h=_-p),t=m,n=h,e.style.transform=`translate(${t}px, ${n}px)`,l.preventDefault()}function y(){s&&(r=t,c=n,s=!1,e.style.transition="transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), background 0.2s, box-shadow 0.3s")}function A(e){if(o)return e.preventDefault(),e.stopPropagation(),!1;E()}e.addEventListener("mousedown",x),e.addEventListener("touchstart",x,{passive:!1}),document.addEventListener("mousemove",w),document.addEventListener("touchmove",w,{passive:!1}),document.addEventListener("mouseup",y),document.addEventListener("touchend",y),e.addEventListener("click",A)}document.querySelectorAll(".toc-content .toc-text").forEach(e=>{if(!e.textContent||e.textContent.trim()===""){const t=e.closest(".toc-item");t&&(t.style.display="none")}});const c=document.querySelectorAll(".toc-content a"),p=document.querySelectorAll(".post-content h2, .post-content h3, .post-content h4");if(c.length&&p.length){c.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const n=this.getAttribute("href"),s=decodeURIComponent(n.slice(1)),t=document.getElementById(s);if(t){const e=100,n=t.getBoundingClientRect().top,s=n+window.pageYOffset-e;window.scrollTo({top:s,behavior:"smooth"}),c.forEach(e=>e.classList.remove("active")),this.classList.add("active")}})});function f(){const t=window.scrollY+120;let e=null;p.forEach(n=>{n.offsetTop<=t&&(e=n)}),c.forEach(t=>{t.classList.remove("active");const n=decodeURIComponent(t.getAttribute("href"));e&&n==="#"+e.id&&t.classList.add("active")})}window.addEventListener("scroll",f),f()}(function(){const t=document.querySelectorAll(".sidebar-card");if(!t.length)return;const s=window.matchMedia("(pointer: coarse)").matches;if(s)return;const n=6;t.forEach(e=>{e.addEventListener("mousemove",t=>{const s=e.getBoundingClientRect(),a=t.clientX-s.left,r=t.clientY-s.top,o=s.width/2,i=s.height/2,c=(r-i)/i*-n,l=(a-o)/o*n;e.style.transform=`perspective(800px) rotateX(${c}deg) rotateY(${l}deg) translateZ(8px) scale(1.02)`,e.classList.add("tilt-active")}),e.addEventListener("mouseleave",()=>{e.style.transform="perspective(800px) rotateX(0) rotateY(0) translateZ(0) scale(1)",e.classList.remove("tilt-active")})})})(),function(){const t=document.getElementById("particleCanvas");if(!t)return;const s=t.getContext("2d"),d=t.closest(".hero");let n=[],o=null,a=!0;const m=window.matchMedia("(pointer: coarse)").matches;if(m){t.style.display="none";return}function c(){const e=d.getBoundingClientRect();t.width=e.width,t.height=e.height}class h{constructor(){this.reset()}reset(){this.x=Math.random()*t.width,this.y=Math.random()*t.height,this.size=Math.random()*2+.5,this.speedX=(Math.random()-.5)*.3,this.speedY=(Math.random()-.5)*.3,this.opacity=Math.random()*.5+.1}update(){this.x+=this.speedX,this.y+=this.speedY,this.x<0&&(this.x=t.width),this.x>t.width&&(this.x=0),this.y<0&&(this.y=t.height),this.y>t.height&&(this.y=0)}draw(){s.beginPath(),s.arc(this.x,this.y,this.size,0,Math.PI*2),s.fillStyle=`rgba(139, 92, 246, ${this.opacity})`,s.fill()}}function r(){n=[];const e=Math.min(25,Math.floor(t.width*t.height/15e3));for(let t=0;t<e;t++)n.push(new h)}function f(){const e=100,t=3;for(let o=0;o<n.length;o++){let i=0;for(let a=o+1;a<n.length;a++){if(i>=t)break;const r=n[o].x-n[a].x,c=n[o].y-n[a].y,l=Math.sqrt(r*r+c*c);if(l<e){const t=(1-l/e)*.15;s.beginPath(),s.strokeStyle=`rgba(139, 92, 246, ${t})`,s.lineWidth=.5,s.moveTo(n[o].x,n[o].y),s.lineTo(n[a].x,n[a].y),s.stroke(),i++}}}}let l=0;function i(){if(!a)return;if(l++,l%2!==0){o=requestAnimationFrame(i);return}s.clearRect(0,0,t.width,t.height),n.forEach(e=>{e.update(),e.draw()}),f(),o=requestAnimationFrame(i)}const p=new IntersectionObserver(e=>{e.forEach(e=>{a=e.isIntersecting,a&&!o&&i()})},{threshold:0});p.observe(d),c(),r(),i();let u;window.addEventListener("resize",()=>{clearTimeout(u),u=setTimeout(()=>{c(),r()},250)}),document.addEventListener("visibilitychange",()=>{document.hidden?(a=!1,o&&(cancelAnimationFrame(o),o=null)):(a=!0,o||i())})}(),function(){const n=document.querySelectorAll(".glass-music-player");if(!n.length)return;let t=null;n.forEach(function(e){const n=e.querySelector(".audio-element"),g=e.querySelector(".play-btn"),a=e.querySelector(".progress-bar"),l=e.querySelector(".progress-fill"),d=e.querySelector(".progress-handle"),f=e.querySelector(".current-time"),p=e.querySelector(".duration"),u=e.querySelector(".volume-btn"),r=e.querySelector(".volume-bar"),h=e.querySelector(".volume-fill");if(!n)return;function m(e){if(isNaN(e))return"0:00";const n=Math.floor(e/60),t=Math.floor(e%60);return n+":"+(t<10?"0":"")+t}g.addEventListener("click",function(){if(n.paused){if(t&&t!==n){t.pause();const e=t.closest(".glass-music-player");e&&e.classList.remove("is-playing")}n.play(),e.classList.add("is-playing"),t=n}else n.pause(),e.classList.remove("is-playing"),t===n&&(t=null)});function s(){n.duration&&!isNaN(n.duration)&&n.duration!==1/0&&(p.textContent=m(n.duration))}n.readyState>=1&&s(),setTimeout(s,100),setTimeout(s,500),n.addEventListener("loadedmetadata",s),n.addEventListener("durationchange",s),n.addEventListener("canplay",s),n.addEventListener("loadeddata",s),n.addEventListener("timeupdate",function(){const e=n.currentTime/n.duration*100;l.style.width=e+"%",d.style.left=e+"%",f.textContent=m(n.currentTime)}),n.addEventListener("ended",function(){e.classList.remove("is-playing"),l.style.width="0%",d.style.left="0%",f.textContent="0:00",t===n&&(t=null)}),n.addEventListener("waiting",function(){e.classList.add("is-loading")}),n.addEventListener("playing",function(){e.classList.remove("is-loading")}),n.addEventListener("error",function(){e.classList.remove("is-loading"),e.classList.add("has-error"),e.classList.remove("is-playing"),console.error("Audio load error:",n.src)});let o=!1;function i(e){const s=a.getBoundingClientRect(),o=(e.clientX||e.touches[0].clientX)-s.left,t=Math.max(0,Math.min(100,o/s.width*100));l.style.width=t+"%",d.style.left=t+"%",n.duration&&(n.currentTime=t/100*n.duration)}a.addEventListener("click",i),a.addEventListener("mousedown",function(e){o=!0,i(e)}),a.addEventListener("touchstart",function(e){o=!0,i(e)},{passive:!0}),document.addEventListener("mousemove",function(e){o&&i(e)}),document.addEventListener("touchmove",function(e){o&&i(e)},{passive:!0}),document.addEventListener("mouseup",function(){o=!1}),document.addEventListener("touchend",function(){o=!1}),u.addEventListener("click",function(){n.muted=!n.muted,u.classList.toggle("is-muted",n.muted)});function c(e){const t=r.getBoundingClientRect(),o=(e.clientX||e.touches[0].clientX)-t.left,s=Math.max(0,Math.min(100,o/t.width*100));n.volume=s/100,h.style.width=s+"%",n.muted=!1,u.classList.remove("is-muted")}r.addEventListener("click",c),r.addEventListener("mousedown",function(e){e.stopPropagation();const t=function(e){c(e)},n=function(){document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",n)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",n)}),r.addEventListener("touchstart",function(e){e.stopPropagation();const t=function(e){c(e)},n=function(){document.removeEventListener("touchmove",t),document.removeEventListener("touchend",n)};document.addEventListener("touchmove",t,{passive:!0}),document.addEventListener("touchend",n)},{passive:!0}),n.volume=.7,h.style.width="70%"})}()})