document.addEventListener("DOMContentLoaded",function(){const g=document.querySelector(".search-toggle"),s=document.getElementById("searchModal"),a=document.getElementById("searchInput"),x=document.getElementById("searchClose"),o=document.getElementById("searchResults");let O=[],n=-1;async function F(){try{const e=await fetch("/search.json");O=await e.json()}catch(e){console.error("Failed to load search data:",e)}}function m(){s.classList.add("active"),a.value="",a.focus(),o.innerHTML="",n=-1,document.body.style.overflow="hidden"}function d(){s.classList.remove("active"),document.body.style.overflow=""}function k(e){if(!e.trim()){o.innerHTML="";return}const t=e.toLowerCase().trim(),n=O.filter(e=>{const n=e.title&&e.title.toLowerCase().includes(t),s=e.content&&e.content.toLowerCase().includes(t);return n||s}).slice(0,10);D(n,t)}function v(e,t){if(!e)return"";const n=new RegExp(`(${t})`,"gi");return e.replace(n,"<mark>$1</mark>")}function D(e,t){if(e.length===0){o.innerHTML='<div class="search-no-results">没有找到相关文章</div>';return}const s=e.map((e,n)=>{const s=e.content?e.content.substring(0,150)+"...":"";return`
        <a href="${e.url}" class="search-result-item" data-index="${n}">
          <div class="search-result-title">${v(e.title,t)}</div>
          <div class="search-result-excerpt">${v(s,t)}</div>
          <div class="search-result-meta">
            <span>${e.date||""}</span>
            ${e.categories?`<span>${e.categories.join(", ")}</span>`:""}
          </div>
        </a>
      `}).join("");o.innerHTML=s,n=-1}function b(){const e=o.querySelectorAll(".search-result-item");e.forEach((e,t)=>{e.classList.toggle("selected",t===n)}),n>=0&&e[n]&&e[n].scrollIntoView({block:"nearest"})}if(g&&g.addEventListener("click",m),x&&x.addEventListener("click",d),s&&s.addEventListener("click",function(e){e.target===s&&d()}),a){let e;a.addEventListener("input",function(){clearTimeout(e),e=setTimeout(()=>{k(this.value)},300)}),a.addEventListener("keydown",function(e){const t=o.querySelectorAll(".search-result-item");switch(e.key){case"Escape":d();break;case"ArrowDown":e.preventDefault(),n=Math.min(n+1,t.length-1),b();break;case"ArrowUp":e.preventDefault(),n=Math.max(n-1,-1),b();break;case"Enter":e.preventDefault(),n>=0&&t[n]?window.location.href=t[n].href:t.length>0&&(window.location.href=t[0].href);break}})}document.addEventListener("keydown",function(e){(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),s.classList.contains("active")?d():m())}),F(),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=document.querySelector(this.getAttribute("href"));t&&t.scrollIntoView({behavior:"smooth",block:"start"})})});const c=document.querySelector(".hero-subtitle");c&&document.querySelector(".posts-section")&&(c.style.cursor="pointer",c.addEventListener("click",()=>{document.querySelector(".posts-section").scrollIntoView({behavior:"smooth",block:"start"})}),c.title="Click to scroll to posts"),document.querySelectorAll(".tabs").forEach(e=>{const t=e.querySelector(".nav-tabs"),s=e.querySelectorAll(".nav-tabs .tab"),n=e.querySelectorAll(".tab-contents .tab-item-content");if(t&&t.scrollWidth>t.clientWidth&&t.classList.add("scrollable"),s.forEach((e,o)=>{e.addEventListener("click",function(){if(s.forEach(e=>e.classList.remove("active")),n.forEach(e=>e.classList.remove("active")),this.classList.add("active"),n[o]&&(void n[o].offsetWidth,n[o].classList.add("active")),window.innerWidth<=767&&t){const e=this.getBoundingClientRect(),n=t.getBoundingClientRect(),s=t.scrollLeft+e.left-n.left-n.width/2+e.width/2;t.scrollTo({left:s,behavior:"smooth"})}})}),t){let e;t.addEventListener("scroll",function(){clearTimeout(e),e=setTimeout(()=>{const e=this.scrollWidth>this.clientWidth,t=this.scrollLeft+this.clientWidth>=this.scrollWidth-10;e&&!t?this.classList.add("scrollable"):this.classList.remove("scrollable")},100)},{passive:!0})}});function z(e){const t=document.createElement("button");return t.className="code-copy-btn",t.type="button",t.innerHTML=`
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
      </svg>
      <span>Copy</span>
    `,t.addEventListener("click",async()=>{const n=e.textContent;try{await navigator.clipboard.writeText(n),t.innerHTML=`
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          <span>Copied!</span>
        `,t.classList.add("copied"),setTimeout(()=>{t.innerHTML=`
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
            </svg>
            <span>Copy</span>
          `,t.classList.remove("copied")},2e3)}catch(e){console.error("Failed to copy:",e)}}),t}function h(e,t){const n=document.createElement("div");n.className="code-toolbar";const s=document.createElement("span");s.className="code-lang-label",s.textContent=(e||"code").toUpperCase();const o=z(t);return n.appendChild(s),n.appendChild(o),n}document.querySelectorAll(".post-content figure.highlight").forEach(e=>{const s=Array.from(e.classList),o=s.find(e=>e!=="highlight"),t=e.querySelector("table"),n=e.querySelector("pre code");if(!t||!n)return;const i=h(o,n);e.insertBefore(i,t),e.classList.add("has-toolbar")}),document.querySelectorAll(".post-content pre:not(figure.highlight pre)").forEach(e=>{const n=e.querySelector("code");if(!n)return;const s=Array.from(n.classList).find(e=>e.startsWith("language-")),o=s?s.replace("language-",""):e.getAttribute("data-lang")||"code",t=document.createElement("figure");t.className="code-block",e.parentNode.insertBefore(t,e),t.appendChild(e);const i=h(o,n);t.insertBefore(i,e)}),document.body.classList.add("loaded");const u=document.querySelectorAll(".post-card");if(u.length>0){const e=new IntersectionObserver(t=>{t.forEach((t)=>{if(t.isIntersecting){const n=Array.from(u).indexOf(t.target);setTimeout(()=>{t.target.classList.add("animate-in")},n*100),e.unobserve(t.target)}})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});u.forEach(t=>{e.observe(t)})}const t=document.getElementById("fabSidebarToggle"),e=document.getElementById("sidebarDrawer"),i=document.getElementById("sidebarOverlay"),_=document.getElementById("sidebarDrawerClose");function M(){e&&e.classList.add("active"),i&&i.classList.add("active"),t&&t.classList.add("hidden"),document.body.style.overflow="hidden";const n=window.innerWidth-document.documentElement.clientWidth;n>0&&(document.body.style.paddingRight=n+"px")}function r(){e&&e.classList.remove("active"),i&&i.classList.remove("active"),t&&t.classList.remove("hidden"),document.body.style.overflow="",document.body.style.paddingRight=""}if(_&&_.addEventListener("click",r),i&&i.addEventListener("click",r),document.addEventListener("keydown",function(t){t.key==="Escape"&&e&&e.classList.contains("active")&&r()}),e){let n=0,s=0,t=!1;e.addEventListener("touchstart",function(o){n=o.touches[0].clientX,s=n,t=!0,e.style.transition="none"},{passive:!0}),e.addEventListener("touchmove",function(o){if(!t)return;s=o.touches[0].clientX;const i=s-n;i<0&&(e.style.transform=`translateX(${i}px)`)},{passive:!0}),e.addEventListener("touchend",function(){if(!t)return;t=!1,e.style.transition="",e.style.transform="";const i=s-n,a=-80;i<a&&r()},{passive:!0}),e.addEventListener("touchcancel",function(){if(!t)return;t=!1,e.style.transition="",e.style.transform=""},{passive:!0})}if(t){let s=!1,o=!1,i,a,r=0,c=0,e=0,n=0;function S(){r=0,c=0,e=0,n=0,t.style.transform="translate(0, 0)",t.style.right="",t.style.top=""}let l;window.addEventListener("resize",function(){clearTimeout(l),l=setTimeout(S,250)});function C(e){if(e.type==="touchstart")return;o=!1,e.type==="touchstart"?(i=e.touches[0].clientX,a=e.touches[0].clientY):(i=e.clientX,a=e.clientY),s=!0,t.style.transition="none",e.preventDefault()}function E(l){if(!s)return;let f,u;l.type==="touchmove"?(f=l.touches[0].clientX,u=l.touches[0].clientY):(f=l.clientX,u=l.clientY);const C=f-i,x=u-a;(Math.abs(C)>5||Math.abs(x)>5)&&(o=!0),e=r+C,n=c+x;const g=t.getBoundingClientRect(),k=g.width,E=g.height,v=getComputedStyle(t),d=parseFloat(v.right)||20,p=parseFloat(v.top)||window.innerHeight*.35,A=-e,b=d+A,j=p+n,y=window.innerWidth-k-10,_=window.innerHeight-E-10,w=10,O=10;let m=e,h=n;b<w?m=-(w-d):b>y&&(m=-(y-d)),j<O?h=O-p:j>_&&(h=_-p),e=m,n=h,t.style.transform=`translate(${e}px, ${n}px)`,l.preventDefault()}function j(){s&&(r=e,c=n,s=!1,t.style.transition="transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), background 0.2s, box-shadow 0.3s")}function A(e){if(o)return e.preventDefault(),e.stopPropagation(),!1;M()}t.addEventListener("mousedown",C),t.addEventListener("touchstart",C,{passive:!1}),document.addEventListener("mousemove",E),document.addEventListener("touchmove",E,{passive:!1}),document.addEventListener("mouseup",j),document.addEventListener("touchend",j),t.addEventListener("click",A)}document.querySelectorAll(".toc-content .toc-text").forEach(e=>{if(!e.textContent||e.textContent.trim()===""){const t=e.closest(".toc-item");t&&(t.style.display="none")}});const l=document.querySelectorAll(".toc-content a"),w=document.querySelectorAll(".post-content h2, .post-content h3, .post-content h4");if(l.length&&w.length){l.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const n=this.getAttribute("href"),s=decodeURIComponent(n.slice(1)),t=document.getElementById(s);if(t){const e=100,n=t.getBoundingClientRect().top,s=n+window.pageYOffset-e;window.scrollTo({top:s,behavior:"smooth"}),l.forEach(e=>e.classList.remove("active")),this.classList.add("active")}})});function y(){const t=window.scrollY+120;let e=null;w.forEach(n=>{n.offsetTop<=t&&(e=n)}),l.forEach(t=>{t.classList.remove("active");const n=decodeURIComponent(t.getAttribute("href"));e&&n==="#"+e.id&&t.classList.add("active")})}window.addEventListener("scroll",y),y()}(function(){const t=document.querySelectorAll(".sidebar-card");if(!t.length)return;const s=window.matchMedia("(pointer: coarse)").matches;if(s)return;const n=6;t.forEach(e=>{e.addEventListener("mousemove",t=>{const s=e.getBoundingClientRect(),a=t.clientX-s.left,r=t.clientY-s.top,o=s.width/2,i=s.height/2,c=(r-i)/i*-n,l=(a-o)/o*n;e.style.transform=`perspective(800px) rotateX(${c}deg) rotateY(${l}deg) translateZ(8px) scale(1.02)`,e.classList.add("tilt-active")}),e.addEventListener("mouseleave",()=>{e.style.transform="perspective(800px) rotateX(0) rotateY(0) translateZ(0) scale(1)",e.classList.remove("tilt-active")})})})(),function(){const t=document.getElementById("particleCanvas");if(!t)return;const s=t.getContext("2d"),d=t.closest(".hero");let n=[],o=null,a=!0;const m=window.matchMedia("(pointer: coarse)").matches;if(m){t.style.display="none";return}function c(){const e=d.getBoundingClientRect();t.width=e.width,t.height=e.height}class h{constructor(){this.reset()}reset(){this.x=Math.random()*t.width,this.y=Math.random()*t.height,this.size=Math.random()*2+.5,this.speedX=(Math.random()-.5)*.3,this.speedY=(Math.random()-.5)*.3,this.opacity=Math.random()*.5+.1}update(){this.x+=this.speedX,this.y+=this.speedY,this.x<0&&(this.x=t.width),this.x>t.width&&(this.x=0),this.y<0&&(this.y=t.height),this.y>t.height&&(this.y=0)}draw(){s.beginPath(),s.arc(this.x,this.y,this.size,0,Math.PI*2),s.fillStyle=`rgba(139, 92, 246, ${this.opacity})`,s.fill()}}function r(){n=[];const e=Math.min(25,Math.floor(t.width*t.height/15e3));for(let t=0;t<e;t++)n.push(new h)}function f(){const e=100,t=3;for(let o=0;o<n.length;o++){let i=0;for(let a=o+1;a<n.length;a++){if(i>=t)break;const r=n[o].x-n[a].x,c=n[o].y-n[a].y,l=Math.sqrt(r*r+c*c);if(l<e){const t=(1-l/e)*.15;s.beginPath(),s.strokeStyle=`rgba(139, 92, 246, ${t})`,s.lineWidth=.5,s.moveTo(n[o].x,n[o].y),s.lineTo(n[a].x,n[a].y),s.stroke(),i++}}}}let l=0;function i(){if(!a)return;if(l++,l%2!==0){o=requestAnimationFrame(i);return}s.clearRect(0,0,t.width,t.height),n.forEach(e=>{e.update(),e.draw()}),f(),o=requestAnimationFrame(i)}const p=new IntersectionObserver(e=>{e.forEach(e=>{a=e.isIntersecting,a&&!o&&i()})},{threshold:0});p.observe(d),c(),r(),i();let u;window.addEventListener("resize",()=>{clearTimeout(u),u=setTimeout(()=>{c(),r()},250)}),document.addEventListener("visibilitychange",()=>{document.hidden?(a=!1,o&&(cancelAnimationFrame(o),o=null)):(a=!0,o||i())})}(),function(){const n=document.querySelectorAll(".glass-music-player");if(!n.length)return;let t=null;n.forEach(function(e){const n=e.querySelector(".audio-element"),g=e.querySelector(".play-btn"),a=e.querySelector(".progress-bar"),l=e.querySelector(".progress-fill"),d=e.querySelector(".progress-handle"),f=e.querySelector(".current-time"),p=e.querySelector(".duration"),u=e.querySelector(".volume-btn"),r=e.querySelector(".volume-bar"),h=e.querySelector(".volume-fill");if(!n)return;function m(e){if(isNaN(e))return"0:00";const n=Math.floor(e/60),t=Math.floor(e%60);return n+":"+(t<10?"0":"")+t}g.addEventListener("click",function(){if(n.paused){if(t&&t!==n){t.pause();const e=t.closest(".glass-music-player");e&&(e.classList.remove("is-playing"),e.classList.remove("is-loading"))}n.play(),e.classList.add("is-playing"),t=n}else n.pause(),e.classList.remove("is-playing"),e.classList.remove("is-loading"),t===n&&(t=null)});function s(){n.duration&&!isNaN(n.duration)&&n.duration!==1/0&&(p.textContent=m(n.duration))}n.readyState>=1&&s(),setTimeout(s,100),setTimeout(s,500),n.addEventListener("loadedmetadata",s),n.addEventListener("durationchange",s),n.addEventListener("canplay",s),n.addEventListener("loadeddata",s),n.addEventListener("timeupdate",function(){const e=n.currentTime/n.duration*100;l.style.width=e+"%",d.style.left=e+"%",f.textContent=m(n.currentTime)}),n.addEventListener("ended",function(){e.classList.remove("is-playing"),l.style.width="0%",d.style.left="0%",f.textContent="0:00",t===n&&(t=null)}),n.addEventListener("waiting",function(){e.classList.add("is-loading")}),n.addEventListener("playing",function(){e.classList.remove("is-loading")}),n.addEventListener("error",function(){e.classList.remove("is-loading"),e.classList.add("has-error"),e.classList.remove("is-playing"),console.error("Audio load error:",n.src)});let o=!1;function i(e){const s=a.getBoundingClientRect(),o=(e.clientX||e.touches[0].clientX)-s.left,t=Math.max(0,Math.min(100,o/s.width*100));l.style.width=t+"%",d.style.left=t+"%",n.duration&&(n.currentTime=t/100*n.duration)}a.addEventListener("click",i),a.addEventListener("mousedown",function(e){o=!0,i(e)}),a.addEventListener("touchstart",function(e){o=!0,i(e)},{passive:!0}),document.addEventListener("mousemove",function(e){o&&i(e)}),document.addEventListener("touchmove",function(e){o&&i(e)},{passive:!0}),document.addEventListener("mouseup",function(){o=!1}),document.addEventListener("touchend",function(){o=!1}),u.addEventListener("click",function(){n.muted=!n.muted,u.classList.toggle("is-muted",n.muted)});function c(e){const t=r.getBoundingClientRect(),o=(e.clientX||e.touches[0].clientX)-t.left,s=Math.max(0,Math.min(100,o/t.width*100));n.volume=s/100,h.style.width=s+"%",n.muted=!1,u.classList.remove("is-muted")}r.addEventListener("click",c),r.addEventListener("mousedown",function(e){e.stopPropagation();const t=function(e){c(e)},n=function(){document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",n)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",n)}),r.addEventListener("touchstart",function(e){e.stopPropagation();const t=function(e){c(e)},n=function(){document.removeEventListener("touchmove",t),document.removeEventListener("touchend",n)};document.addEventListener("touchmove",t,{passive:!0}),document.addEventListener("touchend",n)},{passive:!0}),n.volume=.7,h.style.width="70%"})}();const T=document.querySelectorAll("a, button, .post-card, .category-card, .tag-card, .moment-card");T.forEach(e=>{e.addEventListener("touchstart",function(){this.style.transform="scale(0.98)"},{passive:!0}),e.addEventListener("touchend",function(){this.style.transform=""},{passive:!0}),e.addEventListener("touchcancel",function(){this.style.transform=""},{passive:!0})});let p=0;document.addEventListener("touchend",function(e){const t=Date.now();t-p<=300&&e.preventDefault(),p=t},{passive:!1}),"ontouchstart"in window&&document.body.classList.add("touch-device"),e&&e.addEventListener("touchmove",function(e){this.scrollTop===0&&e.touches[0].clientY>e.touches[0].screenY&&e.preventDefault()},{passive:!1});const f=document.querySelectorAll(".mobile-nav-link");f.forEach(e=>{e.addEventListener("click",function(){f.forEach(e=>e.classList.remove("active")),this.classList.add("active")})}),window.addEventListener("orientationchange",function(){e&&e.classList.contains("active")&&r(),t&&(t.style.transform="")}),document.addEventListener("visibilitychange",function(){})})